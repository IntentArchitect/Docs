# Intent Architect Documentation Project

This is a DocFX-based documentation site for Intent Architect, published to https://docs.intentarchitect.com/docs.

## Architecture Overview

**DocFX Static Site Generation**: The project uses DocFX 2.77.0 to convert Markdown files in `articles/` into static HTML in `_site/`. The `docfx.json` configuration defines content sources, custom templates, and post-processors.

**Multi-Repository Documentation Merge**: Module documentation is automatically pulled from three separate GitHub repositories (Intent.Modules, Intent.Modules.NET, Intent.Modules.Importers) via Azure Pipelines. The `PipelineScripts/merge-repo-docs.ps1` script finds all `README.md` files in module repositories (specifically in `/docs` folders), transforms them into the appropriate folder structure under `articles/modules-*`, and generates corresponding `toc.yml` files.

**Custom DocFX Extensions**: The `docfx-extensions/Intent.DocFx.TagExtensions` C# project provides custom post-processors that run after DocFX builds HTML. Currently implements `FeatherlightImageTag` and `MarkdownVideoTag` handlers for enhanced content presentation.

## Developer Workflows

### Building and Previewing Locally

1. **Install DocFX** (first time only): `.\_install_tools.ps1`
2. **Build and serve**: `.\_build_and_serve.ps1` - Opens browser to http://localhost:8080/
3. **Build only**: `.\_build.ps1`

### Merge Module Documentation Locally

Use `.\merge-local-docs.ps1 "C:\path\to\modules-common" "C:\path\to\modules-dotnet" "modules-common" "modules-dotnet"` to test merging docs from local module repositories before pushing.

### Troubleshooting Build Errors

Delete the `obj/` folder completely if encountering strange build errors. This folder only contains build artifacts.

## Content Guidelines (from guidelines.md)

### File Structure & Naming
- **Article folder structure**: Each article gets its own folder with the markdown file named identically: `article-name/article-name.md`
- **Module documentation naming**: Auto-generated by converting module names to lowercase and replacing `.` with `-`. Example: "Intent.Application.MediatR" → `intent-application-mediatr/intent-application-mediatr.md`
- **Images**: Store in `images/` subfolder within article folder, reference as `images/filename.png`

### Frontmatter & Metadata
All articles must include YAML frontmatter with `uid`:
```yaml
---
uid: application-development.modelling.about-designers
---
```

### Navigation (toc.yml)
- **Alphabetical ordering**: All TOC entries sorted A-Z with TWO exceptions:
  - "Getting Started" pinned to top
  - "Release Notes" pinned to bottom
- **TOC structure**: High-level sections in root `toc.yml`, nested articles in folder-specific `toc.yml` files
- **Format** (see `guidelines.md` for examples):
  ```yaml
  items:
  - name: Article Title
    href: folder-name/article-name.md
  ```

### Cross-References & Links
- **Internal links**: ALWAYS use `xref:` syntax, never relative paths
  - Example: `[](xref:tools.software-factory-cli)` NOT `[](../tools/software-factory-cli.md)`
  - DocFX resolves paths during build; JavaScript handles redirects
- **Content redirects**: When moving/renaming articles, keep old `.md` file with redirect template:
  ```markdown
  # Content moved
  
  Content has moved to <span id="redirect_container">[here](xref:new.article.uid)</span>.
  
  <script>
    window.location.href = document.querySelector("#redirect_container a").href;
  </script>
  ```

### Writing Style
- **Headings**: Declarative form, NOT questions
  - ✅ "Why Intent Architect isn't using Package Managers"
  - ❌ "Why isn't Intent Architect using Package Managers?"
  - Exception: Acceptable when heading IS the question (e.g., "What is a Module?")
- **Tutorial vs How-To**:
  - **Tutorials**: Step-by-step, no decisions, designed for learning
  - **How-To**: Self-contained, actionable, don't require completing tutorials first
- **Alerts**: Use DocFX alert syntax for callouts:
  ```markdown
  > [!NOTE]
  > Informational content here
  
  > [!WARNING]
  > Warning content here
  
  > [!TIP]
  > Helpful tip here
  ```

### Screenshots & Media
- **Taking screenshots**: Run Intent Architect with `--docs-mode` flag for proper sizing
- **Developer console setup** (Profile button > Debug):
  ```js
  require("electron").ipcRenderer.send("relaunch-as-frameless");
  require("electron").ipcRenderer.send("set-size", { width: 1280, height: 720 });
  angular.element(document.querySelector("html")).injector().get("EventAggregator").publish("set-presentation-mode", true);
  ```
- **Image annotations**: Use "Azure Blue" (`#06C4FF`) per brand guidelines
- **Image syntax**: `![Description](images/filename.png)` with optional italic caption below:
  ```markdown
  ![Domain Designer](images/designers-domain.png)
  _An example showing a Domain Designer with a modelled domain._
  ```

### Markdown Formatting
- **Tables**: Use VS Code command "Evenly distribute selected table" (Ctrl+Shift+P) for formatting
- **Code blocks**: Specify language for syntax highlighting (```csharp, ```yaml, etc.)
- **Markdig extensions**: `attributes` and `advanced` extensions enabled in `docfx.json`

## CI/CD Pipeline

**Azure Pipelines** (`azure-pipelines.yml`) triggers on pushes to `master`/`development` branches OR when module repositories push updates. The pipeline:

1. Determines which repository/branch triggered the build
2. Clones all three module repositories (matching branch names when available, falling back to `development`)
3. Runs `merge-repo-docs.ps1` for each module repository
4. Builds the site with DocFX
5. Syncs `_site/` to Azure Blob Storage (pre-production for feature branches, production for master/development)

**Branch-Based Deployments**: Non-master/development branches deploy to pre-production storage with branch name as container prefix for preview environments.

## Key Files & Directories

- `docfx.json` - DocFX configuration (content sources, templates, metadata, post-processors)
- `articles/` - All documentation content organized by topic folders
- `articles/*/toc.yml` - Table of contents for navigation hierarchy
- `Template/darkerfx_custom/` - Custom DocFX theme (layout, styles, partials, plugins)
- `docfx-extensions/Intent.DocFx.TagExtensions/` - C# post-processor plugins (builds to DLL referenced in docfx.json)
- `guidelines.md` - Content authoring rules (required reading before contributions)
- `PipelineScripts/merge-repo-docs.ps1` - Automated module documentation aggregation
- `.application.*.xml` files in docs - Intent Architect metadata (not present here as this is pure docs repo)

## External Dependencies

- **DocFX 2.77.0**: Installed via `dotnet tool install` (see `_install_tools.ps1`)
- **Module Repositories**: Documentation content auto-merged from external repos during CI
- **Azure Blob Storage**: Hosting target for compiled static site
- **Markdig Extensions**: `attributes` and `advanced` extensions enabled for enhanced markdown
