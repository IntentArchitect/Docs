---
uid: application-development.code-weaving-and-generation.practical-code-management-examples
---

# Practical C# Code Management Examples

This guide provides practical examples for common code management scenarios in Intent Architect. Each example demonstrates how to handle real-world situations where you need to customize or extend generated code.

For a comprehensive explanation of code management concepts, see the [C# Code Management](xref:application-development.code-weaving-and-generation.about-code-management-csharp) documentation.

## Choosing the Right Code Management Technique

Intent Architect provides multiple code management techniques: `[IntentIgnore]`, `[IntentManaged(Mode.Ignore)]`, `// IntentIgnore` (along with the other variants). The choice depends on where you're applying the instruction:

**Use attribute-based techniques** (e.g., `[IntentIgnore]` or `[IntentManaged(Mode.Ignore)]`) when working with:

- Classes
- Methods
- Properties
- Any other C# element that supports attributes

**Use comment-based techniques** (e.g., `// IntentIgnore`) when working with:

- Statement blocks inside method bodies
- Individual lines of code
- Any location where C# attributes are not valid

## Practical Examples

### Preserving Custom Methods

**Scenario:** You've manually added a method to a class, but Intent Architect attempts to remove it during the Software Factory execution.

![Method removal](images/method-removal.png)

**Cause:** The class is fully managed (`[IntentManaged(Mode.Fully, Signature = Mode.Fully)]`), and Intent Architect doesn't recognize the custom method as part of the template output.

**Solutions:**

#### Option 1: Use Class-Level Merge Mode

Change the class-level attribute to `[IntentManaged(Mode.Merge, Signature = Mode.Fully)]`. This instructs Intent Architect to merge generated methods with any developer-added methods.

**Best for:** Adding multiple custom methods to the same class.

#### Option 2: Apply Method-Level Ignore Attribute

Add the `[IntentIgnore]` attribute above the custom method:

```csharp
[IntentIgnore]
private string MyHelperMethod(string name)
{
    return name.ToLower();
}
```

**Best for:** Preserving individual custom methods while keeping the class fully managed.

### Preserving Custom Code in Method Bodies

**Scenario:** You need to add custom code to a generated method, but Intent Architect attempts to remove it.

![Code Line removal](images/code-line-removal.png)

**Cause:** The method body is fully managed (`[IntentManaged(Mode.Fully, Body = Mode.Fully)]`), and Intent Architect doesn't recognize the custom code as part of the template output.

**Solutions:**

#### Option 1: Use Method Body Merge Mode

Change the method attribute to `[IntentManaged(Mode.Fully, Body = Mode.Merge)]`. This instructs Intent Architect to merge generated code with custom code within the method body. The method signature and attributes remain fully managed.

**Best for:** Adding multiple custom lines throughout a method body.

``` csharp
[IntentManaged(Mode.Fully, Body = Mode.Merge)]
public async Task<Guid> Handle(CreateProductCommand request, CancellationToken cancellationToken)
{
    request.Name = MyHelperMethod(request.Name);

    var product = new Product
    {
        Name = request.Name,
        Description = request.Description,
        Qty = request.Qty
    };

    _productRepository.Add(product);
    await _productRepository.UnitOfWork.SaveChangesAsync(cancellationToken);
    return product.Id;
}
```

#### Option 2: Use Statement-Level Ignore

Add the `// IntentIgnore` comment above the specific line or block you want to preserve. Since attributes cannot be applied to individual statements, the comment-based approach is required.

**Best for:** Preserving specific lines of custom code while keeping the method body fully managed.

``` csharp
[IntentManaged(Mode.Fully, Body = Mode.Fully)]
public async Task<Guid> Handle(CreateProductCommand request, CancellationToken cancellationToken)
{
    // IntentIgnore
    request.Name = MyHelperMethod(request.Name);

    var product = new Product
    {
        Name = request.Name,
        Description = request.Description,
        Qty = request.Qty
    };

    _productRepository.Add(product);
    await _productRepository.UnitOfWork.SaveChangesAsync(cancellationToken);
    return product.Id;
}
```

Even though the body remains in `Fully` mode, the `// IntentIgnore` comment overrides management for that specific statement.

### Adding to Generated Code Blocks

**Scenario:** You need to add statements to a code block generated by Intent Architect, but the additions are removed during Software Factory execution.

![Adding a custom code line](images/custom-code-line-add.png)

> [!NOTE]
> This example covers *adding statements* to a generated block. For *modifying existing statements*, see [Updating Generated Code Blocks](#updating-generated-code-blocks).

**Solutions:**

#### Option 1: Method Body Merge Mode

Change the method attribute to `[IntentManaged(Mode.Fully, Body = Mode.Merge)]`. This allows Intent Architect to merge generated code with custom additions throughout the method body.

**Best for:** Adding multiple custom statements across the method.

``` csharp
[IntentManaged(Mode.Fully, Body = Mode.Merge)]
public async Task<Guid> Handle(CreateProductCommand request, CancellationToken cancellationToken)
{
    // IntentIgnore
    request.Name = MyHelperMethod(request.Name);

    var product = new Product
    {
        Name = request.Name,
        Description = request.Description,
        Qty = request.Qty,
        DateCreated = DateTime.UtcNow
    };

    _productRepository.Add(product);
    await _productRepository.UnitOfWork.SaveChangesAsync(cancellationToken);
    return product.Id;
}
```

#### Option 2: Use Statement Block Merge

Add the `// IntentMerge` comment above the specific code block. This instructs Intent Architect to merge generated statements with your additions within that block only.

**Best for:** Adding statements to a specific code block while keeping other parts of the method fully managed.

``` csharp
[IntentManaged(Mode.Fully, Body = Mode.Fully)]
public async Task<Guid> Handle(CreateProductCommand request, CancellationToken cancellationToken)
{
    // IntentIgnore
    request.Name = MyHelperMethod(request.Name);

    // IntentMerge
    var product = new Product
    {
        Name = request.Name,
        Description = request.Description,
        Qty = request.Qty,
        DateCreated = DateTime.UtcNow
    };

    _productRepository.Add(product);
    await _productRepository.UnitOfWork.SaveChangesAsync(cancellationToken);
    return product.Id;
}
```

### Updating Generated Code Blocks

**Scenario:** You need to modify a statement within a code block generated by Intent Architect, but the changes are reverted during Software Factory execution.

![Updated a generated code line](images/custom-code-line-update.png)

**Cause:** When you modify an existing generated statement (like changing `x => x.Active && x.Qty > 0`), Intent Architect cannot merge the code because the statement itself is being replaced, not added to.

> [!NOTE]
> This example covers *modifying existing statements*. For *adding new statements*, see [Adding to Generated Code Blocks](#adding-to-generated-code-blocks).

**Solution:**

#### Use Statement-Level Ignore

Add the `// IntentIgnore` comment above the modified statement to preserve your changes:

``` csharp
[IntentManaged(Mode.Fully, Body = Mode.Merge)]
public async Task<List<ProductDto>> Handle(GetProductsQuery request, CancellationToken cancellationToken)
{
    // IntentIgnore
    var products = await _productRepository.FindAllAsync(x => x.Active && x.Qty > 0, cancellationToken);
    return products.MapToProductDtoList(_mapper); 
}
```

You can apply this to individual statements within larger blocks. In the example below, only the `Description = $"{request.Description}...",` line is ignored:

``` csharp
[IntentManaged(Mode.Fully, Body = Mode.Fully)]
public async Task<Guid> Handle(CreateProductCommand request, CancellationToken cancellationToken)
{
    // IntentIgnore
    request.Name = MyHelperMethod(request.Name);

    // IntentMerge
    var product = new Product
    {
        Name = request.Name,
        // IntentIgnore
        Description = $"{request.Description}...",
        Qty = request.Qty,
        DateCreated = DateTime.UtcNow
    };

    _productRepository.Add(product);
    await _productRepository.UnitOfWork.SaveChangesAsync(cancellationToken);
    return product.Id;
}
```

### Adding to Generated Method Chains

**Scenario:** You need to add a method call to a fluent method chain generated by Intent Architect, but the addition is removed during Software Factory execution.

![Method chain update](images/statement-chain-add.png)

**Solution:**

#### Use Inline Ignore Comment

Add the `// IntentIgnore` comment before the specific method call you want to preserve within the chain:

``` csharp
builder.Property(x => x.Description)
    // IntentIgnore
    .HasAnnotation("Description", "Display name shown to customers")
    .IsRequired();
```

**Best for:** Adding specific method calls to fluent chains while keeping other parts of the chain managed.
